<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>cyber chowchow - {% block title %}{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- Font & Icon -->
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Custom CSS -->
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
</head>
<body>
  <!-- Navbar Start -->
  <nav class="navbar navbar-expand-lg bg-white navbar-light shadow sticky-top p-0">
    <a href="{{ url_for('home') }}" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
        <h2 class="m-0 text-primary"><i class="fa fa-book me-3"></i>CHOW CHOW</h2>
    </a>
    <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <div class="navbar-nav ms-auto p-4 p-lg-0">
            <a href="{{ url_for('home') }}" class="nav-item nav-link active">HOME</a>
            <a href="{{ url_for('about') }}" class="nav-item nav-link">ABOUT</a>
            <a href="{{ url_for('course') }}" class="nav-item nav-link">COURSE</a>
            <div class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">PAGES</a>
                <div class="dropdown-menu fade-down m-0">
                    <a href="team.html" class="dropdown-item">Our Team</a>
                    <a href="testimonial.html" class="dropdown-item">Testimonial</a>
                    <a href="404.html" class="dropdown-item">404 Page</a>
                </div>
            </div>
            <a href="{{ url_for('contact') }}" class="nav-item nav-link">CONTACT</a>
        </div>
        
        {% if current_user.is_authenticated %}
            <div class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle btn btn-primary py-4 px-lg-5 d-none d-lg-block" data-bs-toggle="dropdown">
                    <i class="fa fa-user-circle me-2"></i>
                    {% if current_user.profile_image %}
                        <img src="{{ url_for('static', filename='profile_images/' ~ current_user.profile_image) }}?v={{ now().timestamp() }}" class="rounded-circle me-2" style="width: 30px; height: 30px; object-fit: cover;"> {# ✅ เพิ่ม cache busting #}
                    {% else %}
                        <img src="{{ url_for('static', filename='profile_images/default.png') }}?v={{ now().timestamp() }}" class="rounded-circle me-2" style="width: 30px; height: 30px; object-fit: cover;"> {# ✅ เพิ่ม cache busting #}
                    {% endif %}
                    {% if current_user.first_name and current_user.last_name %}
                        {{ current_user.first_name }} {{ current_user.last_name }}
                    {% elif current_user.username %}
                        {{ current_user.username }}
                    {% else %}
                        ผู้ใช้งาน
                    {% endif %}
                </a>
                <div class="dropdown-menu fade-down m-0">
                    {% if current_user.role == 'admin' %}
                        <a href="{{ url_for('admin_dashboard') }}" class="dropdown-item">Dashboard Admin</a>
                    {% elif current_user.role == 'instructor' %}
                        <a href="{{ url_for('instructor_dashboard') }}" class="dropdown-item">Dashboard Instructor</a>
                    {% else %}
                        <a href="{{ url_for('user_dashboard') }}" class="dropdown-item">Dashboard User</a>
                    {% endif %}
                    <a href="{{ url_for('edit_profile') }}" class="dropdown-item">แก้ไขโปรไฟล์</a>
                    <a href="{{ url_for('logout') }}" class="dropdown-item">ออกจากระบบ</a>
                </div>
            </div>
        {% else %}
            <a href="{{ url_for('login') }}" class="btn btn-primary py-4 px-lg-5 d-none d-lg-block">
                Login <i class="fa fa-arrow-right ms-3"></i>
            </a>
        {% endif %}

    </div>
</nav>
  <!-- Navbar End -->

  <!-- Content -->
  <main class="container my-4">
    {% block content %}{% endblock %}
  </main>

  <!-- Bootstrap JS Bundle (รวม Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
