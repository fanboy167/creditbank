{% extends 'base.html' %}
{% block title %}เส้นทางการเรียนรู้: {{ course.title }}{% endblock %}

{% block custom_styles %}
<style>
    .locked-item {
        opacity: 0.6;
        pointer-events: none;
    }
    .locked-item a, .locked-item button {
        pointer-events: none;
    }
</style>
{% endblock %}

{% block content %}
{% include "component/header.html" %}

<div class="container-fluid bg-primary py-5 mb-5 page-header">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10 text-center">
                <h1 class="display-3 text-white animated slideInDown">เส้นทางการเรียนรู้</h1>
                <h4 class="text-white">{{ course.title }}</h4>
            </div>
        </div>
    </div>
</div>

<div class="container-xxl py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="mb-4">
                    <h4 class="mb-2">ความคืบหน้ารวม: {{ "%.2f"|format(overall_progress_percentage|default(0)) }}%</h4>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar" style="width: {{ overall_progress_percentage|default(0) }}%"></div>
                    </div>
                </div>

                <div class="list-group">
                    {% for item in learning_path_data %}
                        
                        {# --- ส่วนแสดงผลเนื้อหาที่ถูกล็อก --- #}
                        {% if item.is_locked %}
                            {% if item.type == 'lesson' %}
                                <div class="list-group-item list-group-item-action bg-light p-3 mb-2 rounded shadow-sm locked-item">
                                    <h5 class="mb-1 text-muted"><i class="fas fa-lock me-2"></i>บทเรียน: {{ item.title }}</h5>
                                </div>
                            {% else %}
                                <div class="list-group-item list-group-item-action ps-5 py-3 mb-1 rounded-sm border-0 border-start border-secondary border-3 locked-item">
                                    <h6 class="mb-1 text-muted">
                                        {% if 'test' in item.type %}<i class="fas fa-question-circle me-2"></i>
                                        {% elif 'video' in item.type %}<i class="fas fa-video me-2"></i>
                                        {% endif %}
                                        {{ item.title }}
                                    </h6>
                                </div>
                            {% endif %}

                        {# --- ส่วนแสดงผลเนื้อหาที่ปลดล็อกแล้ว --- #}
                        {% else %}
                            {% if item.type == 'lesson' %}
                                <div class="list-group-item list-group-item-action bg-light p-3 mb-2 rounded shadow-sm">
                                    <h5 class="mb-1 text-success"><i class="fas fa-book-open me-2"></i>บทเรียน: {{ item.title }}</h5>
                                </div>
                            
                            {# VVVVVV แก้ไขจุดนี้: เปลี่ยน pre_test_course เป็น pre_test_lesson VVVVVV #}
                            {% elif item.type == 'pre_test_lesson' %}
                                <a href="{{ url_for('start_quiz', quiz_id=item.quiz_id) }}" class="list-group-item list-group-item-action ps-5 py-3 mb-1 rounded-sm border-0 border-start border-primary border-3">
                                    <div class="d-flex w-100 justify-content-between align-items-center">
                                        <h6 class="mb-1"><i class="fas fa-question-circle me-2 text-primary"></i>{{ item.title }}</h6>
                                        <span class="badge bg-{{ 'success' if item.passed else 'warning' }} rounded-pill">{{ item.status }}</span>
                                    </div>
                                    <small class="text-muted">เกณฑ์ผ่าน: {{ item.passing_percentage }}%</small>
                                </a>

                            {% elif item.type == 'video_content' %}
                                <a href="{{ url_for('user_view_lesson', lesson_id=item.lesson_id) }}" class="list-group-item list-group-item-action ps-5 py-3 mb-1 rounded-sm border-0 border-start border-info border-3">
                                    <div class="d-flex w-100 justify-content-between align-items-center">
                                        <h6 class="mb-1"><i class="fas fa-video me-2 text-info"></i>{{ item.title }}</h6>
                                        <span class="badge bg-{{ 'success' if item.is_completed else 'secondary' }} rounded-pill">{{ item.status }}</span>
                                    </div>
                                </a>
                            
                            {% elif item.type == 'post_test_lesson' %}
                                <a href="{{ url_for('start_quiz', quiz_id=item.quiz_id) }}" class="list-group-item list-group-item-action ps-5 py-3 mb-1 rounded-sm border-0 border-start border-danger border-3">
                                    <div class="d-flex w-100 justify-content-between align-items-center">
                                        <h6 class="mb-1"><i class="fas fa-clipboard-check me-2 text-danger"></i>{{ item.title }}</h6>
                                        <span class="badge bg-{{ 'success' if item.passed else 'warning' }} rounded-pill">{{ item.status }}</span>
                                    </div>
                                    <small class="text-muted">เกณฑ์ผ่าน: {{ item.passing_percentage }}%</small>
                                </a>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

{% include "component/footer.html" %}
{% endblock %}